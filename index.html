<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SwiftPDF Pro | PDF Utility Tool</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }
        
        body {
            transition: background-color 0.3s, color 0.3s;
        }
        
        body.dark-mode {
            background-color: #0f172a;
            color: #e2e8f0;
        }
        
        .card {
            transition: transform 0.3s, box-shadow 0.3s;
        }
        
        .card:hover {
            transform: translateY(-5px);
        }
        
        .status-area {
            min-height: 60px;
            transition: all 0.3s;
        }
        
        .hidden {
            display: none !important;
        }
        
        #pdfCanvas {
            position: absolute;
            top: -1000px;
            left: -1000px;
        }
        
        .progress-bar {
            height: 6px;
            border-radius: 3px;
            overflow: hidden;
            background-color: #e2e8f0;
        }
        
        .progress-bar-fill {
            height: 100%;
            width: 0%;
            background-color: #3b82f6;
            transition: width 0.3s;
        }
        
        .dark-mode .progress-bar {
            background-color: #334155;
        }
        
        .file-drop-area {
            border: 2px dashed #cbd5e1;
            border-radius: 8px;
            transition: all 0.3s;
        }
        
        .dark-mode .file-drop-area {
            border-color: #475569;
        }
        
        .file-drop-area.dragover {
            border-color: #3b82f6;
            background-color: rgba(59, 130, 246, 0.05);
        }
        
        .dark-mode .file-drop-area.dragover {
            background-color: rgba(59, 130, 246, 0.1);
        }
        
        .image-preview-container {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 15px;
        }
        
        .image-preview {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        .dark-mode .image-preview {
            border-color: #475569;
        }
        
        .page-thumbnail {
            width: 120px;
            height: 160px;
            object-fit: cover;
            border-radius: 6px;
            border: 2px solid #cbd5e1;
        }
        
        .dark-mode .page-thumbnail {
            border-color: #475569;
        }
        
        .page-thumbnail-container {
            position: relative;
            display: inline-block;
            margin: 10px;
        }
        
        .page-number {
            position: absolute;
            top: 5px;
            left: 5px;
            background-color: rgba(0, 0, 0, 0.7);
            color: white;
            padding: 2px 6px;
            border-radius: 4px;
            font-size: 12px;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 text-gray-800 dark:text-gray-200">
    <div class="container mx-auto px-4 py-8 max-w-6xl">
        <!-- Header -->
        <header class="flex flex-col md:flex-row justify-between items-center mb-10">
            <div class="flex items-center mb-6 md:mb-0">
                <div class="bg-blue-600 w-12 h-12 rounded-xl flex items-center justify-center mr-4">
                    <i class="fas fa-file-pdf text-white text-2xl"></i>
                </div>
                <div>
                    <h1 class="text-3xl font-bold">SwiftPDF Pro</h1>
                    <p class="text-gray-500 dark:text-gray-400">Robust PDF utility for all your document needs</p>
                </div>
            </div>
            
            <!-- Dark/Light Mode Toggle -->
            <div class="flex items-center space-x-4">
                <div class="status-area bg-white dark:bg-gray-800 rounded-lg shadow-md p-4 min-w-[300px] text-center" id="statusArea">
                    <div class="text-gray-500 dark:text-gray-400">Ready to process your files</div>
                    <div class="progress-bar mt-2">
                        <div class="progress-bar-fill" id="progressBar"></div>
                    </div>
                    <div class="text-sm mt-1" id="progressText"></div>
                </div>
                
                <button id="themeToggle" class="bg-gray-200 dark:bg-gray-700 rounded-full p-3">
                    <i class="fas fa-moon dark:hidden"></i>
                    <i class="fas fa-sun hidden dark:inline"></i>
                </button>
            </div>
        </header>
        
        <!-- Main Content - Three Cards -->
        <main class="grid grid-cols-1 lg:grid-cols-3 gap-8">
            <!-- Image to PDF Card -->
            <div class="card bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                <div class="flex items-center mb-6">
                    <div class="bg-blue-100 dark:bg-blue-900 p-3 rounded-lg mr-4">
                        <i class="fas fa-images text-blue-600 dark:text-blue-300 text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold">Image to PDF</h2>
                </div>
                
                <p class="text-gray-600 dark:text-gray-400 mb-6">Combine multiple images into a single PDF document. Supports JPG, PNG, and WebP formats.</p>
                
                <div class="file-drop-area p-8 text-center" id="imageDropArea">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 dark:text-gray-500 mb-4"></i>
                    <p class="mb-2">Drag & drop images here</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">or click to browse</p>
                    <input type="file" id="imageInput" accept="image/*" multiple class="hidden">
                    <button id="browseImagesBtn" class="bg-blue-600 hover:bg-blue-700 text-white font-medium py-2 px-6 rounded-lg transition">
                        Browse Images
                    </button>
                </div>
                
                <div id="imagePreviewContainer" class="image-preview-container"></div>
                
                <div class="mt-6">
                    <label for="pageSize" class="block mb-2 font-medium">Page Size</label>
                    <select id="pageSize" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg">
                        <option value="a4">A4</option>
                        <option value="letter">Letter</option>
                        <option value="legal">Legal</option>
                        <option value="fit">Fit to Image</option>
                    </select>
                </div>
                
                <div class="mt-6">
                    <label for="pageOrientation" class="block mb-2 font-medium">Orientation</label>
                    <select id="pageOrientation" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg">
                        <option value="portrait">Portrait</option>
                        <option value="landscape">Landscape</option>
                    </select>
                </div>
                
                <button id="createPdfBtn" class="w-full mt-8 bg-blue-600 hover:bg-blue-700 text-white font-semibold py-3 px-6 rounded-lg transition">
                    <i class="fas fa-file-pdf mr-2"></i> Create PDF
                </button>
            </div>
            
            <!-- PDF Compressor Card -->
            <div class="card bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                <div class="flex items-center mb-6">
                    <div class="bg-green-100 dark:bg-green-900 p-3 rounded-lg mr-4">
                        <i class="fas fa-compress-arrows-alt text-green-600 dark:text-green-300 text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold">PDF Compressor</h2>
                </div>
                
                <p class="text-gray-600 dark:text-gray-400 mb-6">Reduce PDF file size while maintaining quality. Compress PDFs for sharing and storage.</p>
                
                <div class="file-drop-area p-8 text-center" id="compressDropArea">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 dark:text-gray-500 mb-4"></i>
                    <p class="mb-2">Drag & drop PDF here</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">or click to browse</p>
                    <input type="file" id="compressInput" accept=".pdf" class="hidden">
                    <button id="browseCompressBtn" class="bg-green-600 hover:bg-green-700 text-white font-medium py-2 px-6 rounded-lg transition">
                        Browse PDF
                    </button>
                </div>
                
                <div class="mt-6" id="compressFileInfo"></div>
                
                <div class="mt-6">
                    <label for="compressionLevel" class="block mb-2 font-medium">Compression Level</label>
                    <select id="compressionLevel" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg">
                        <option value="high">High Compression (Smaller file)</option>
                        <option value="medium" selected>Medium Compression (Recommended)</option>
                        <option value="low">Low Compression (Better quality)</option>
                    </select>
                </div>
                
                <button id="compressPdfBtn" class="w-full mt-8 bg-green-600 hover:bg-green-700 text-white font-semibold py-3 px-6 rounded-lg transition">
                    <i class="fas fa-tachometer-alt mr-2"></i> Compress PDF
                </button>
            </div>
            
            <!-- PDF to Image Card -->
            <div class="card bg-white dark:bg-gray-800 rounded-2xl shadow-xl p-6">
                <div class="flex items-center mb-6">
                    <div class="bg-purple-100 dark:bg-purple-900 p-3 rounded-lg mr-4">
                        <i class="fas fa-file-image text-purple-600 dark:text-purple-300 text-2xl"></i>
                    </div>
                    <h2 class="text-2xl font-bold">PDF to Image</h2>
                </div>
                
                <p class="text-gray-600 dark:text-gray-400 mb-6">Convert PDF pages to high-quality images. Download as JPEG or PNG format.</p>
                
                <div class="file-drop-area p-8 text-center" id="pdfToImgDropArea">
                    <i class="fas fa-cloud-upload-alt text-4xl text-gray-400 dark:text-gray-500 mb-4"></i>
                    <p class="mb-2">Drag & drop PDF here</p>
                    <p class="text-sm text-gray-500 dark:text-gray-400 mb-4">or click to browse</p>
                    <input type="file" id="pdfToImgInput" accept=".pdf" class="hidden">
                    <button id="browsePdfToImgBtn" class="bg-purple-600 hover:bg-purple-700 text-white font-medium py-2 px-6 rounded-lg transition">
                        Browse PDF
                    </button>
                </div>
                
                <div class="mt-6" id="pdfToImgFileInfo"></div>
                
                <div class="mt-6">
                    <label for="imageFormat" class="block mb-2 font-medium">Image Format</label>
                    <select id="imageFormat" class="w-full p-3 bg-gray-50 dark:bg-gray-700 border border-gray-300 dark:border-gray-600 rounded-lg">
                        <option value="jpeg">JPEG (Recommended)</option>
                        <option value="png">PNG (Lossless)</option>
                    </select>
                </div>
                
                <div class="mt-6">
                    <label for="imageQuality" class="block mb-2 font-medium">Image Quality</label>
                    <input type="range" id="imageQuality" min="1" max="10" value="8" class="w-full">
                    <div class="flex justify-between text-sm text-gray-500">
                        <span>Low</span>
                        <span id="qualityValue">High (8/10)</span>
                    </div>
                </div>
                
                <button id="convertToImagesBtn" class="w-full mt-8 bg-purple-600 hover:bg-purple-700 text-white font-semibold py-3 px-6 rounded-lg transition">
                    <i class="fas fa-image mr-2"></i> Convert to Images
                </button>
            </div>
        </main>
        
        <!-- Hidden Canvas for PDF to Image conversion -->
        <canvas id="pdfCanvas" class="hidden"></canvas>
        
        <!-- Footer -->
        <footer class="mt-12 pt-8 border-t border-gray-200 dark:border-gray-700 text-center text-gray-500 dark:text-gray-400">
            <p>SwiftPDF Pro - A robust PDF utility tool. All processing happens in your browser.</p>
            <p class="mt-2 text-sm">Compatible with modern browsers. Uses PDF.js, jsPDF, and PDF-Lib libraries.</p>
        </footer>
    </div>

    <!-- Load external libraries with specific versions -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.min.js"></script>
    
    <!-- Main JavaScript -->
    <script>
        // Check if libraries are loaded properly
        document.addEventListener('DOMContentLoaded', function() {
            // Set status based on library availability
            if (typeof window.jspdf !== 'undefined' && window.PDFLib && window.pdfjsLib) {
                updateStatus('All libraries loaded successfully', 'success');
            } else {
                updateStatus('Some libraries failed to load. Please refresh the page.', 'error');
            }
            
            // Initialize theme
            initTheme();
            
            // Initialize event listeners
            initEventListeners();
        });
        
        // Theme toggle functionality
        function initTheme() {
            const themeToggle = document.getElementById('themeToggle');
            const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;
            const savedTheme = localStorage.getItem('theme');
            
            // Set initial theme
            if (savedTheme === 'dark' || (!savedTheme && prefersDark)) {
                document.body.classList.add('dark-mode');
            }
            
            themeToggle.addEventListener('click', () => {
                document.body.classList.toggle('dark-mode');
                const isDark = document.body.classList.contains('dark-mode');
                localStorage.setItem('theme', isDark ? 'dark' : 'light');
            });
        }
        
        // Update status area
        function updateStatus(message, type = 'info') {
            const statusArea = document.getElementById('statusArea');
            const statusText = statusArea.querySelector('div:first-child');
            
            statusText.textContent = message;
            
            // Reset colors
            statusArea.classList.remove('text-green-600', 'text-red-600', 'text-blue-600', 'text-yellow-600');
            statusArea.classList.remove('border-green-500', 'border-red-500', 'border-blue-500', 'border-yellow-500');
            
            // Set color based on type
            switch(type) {
                case 'success':
                    statusArea.classList.add('text-green-600', 'border-green-500');
                    break;
                case 'error':
                    statusArea.classList.add('text-red-600', 'border-red-500');
                    break;
                case 'warning':
                    statusArea.classList.add('text-yellow-600', 'border-yellow-500');
                    break;
                default:
                    statusArea.classList.add('text-blue-600', 'border-blue-500');
            }
        }
        
        // Update progress bar
        function updateProgress(percent, text = '') {
            const progressBar = document.getElementById('progressBar');
            const progressText = document.getElementById('progressText');
            
            progressBar.style.width = `${percent}%`;
            progressText.textContent = text;
        }
        
        // Initialize all event listeners
        function initEventListeners() {
            // Image to PDF functionality
            const imageDropArea = document.getElementById('imageDropArea');
            const imageInput = document.getElementById('imageInput');
            const browseImagesBtn = document.getElementById('browseImagesBtn');
            const createPdfBtn = document.getElementById('createPdfBtn');
            const imagePreviewContainer = document.getElementById('imagePreviewContainer');
            
            let selectedImages = [];
            
            // Setup drag and drop for images
            setupFileDrop(imageDropArea, imageInput, handleImagesSelected);
            
            browseImagesBtn.addEventListener('click', () => imageInput.click());
            
            imageInput.addEventListener('change', function(e) {
                handleImagesSelected(e.target.files);
            });
            
            // Handle images selection
            function handleImagesSelected(files) {
                selectedImages = [];
                imagePreviewContainer.innerHTML = '';
                
                if (files.length === 0) return;
                
                for (let i = 0; i < files.length; i++) {
                    const file = files[i];
                    if (!file.type.match('image.*')) continue;
                    
                    selectedImages.push(file);
                    
                    // Create preview
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const img = document.createElement('img');
                        img.src = e.target.result;
                        img.className = 'image-preview';
                        img.title = file.name;
                        imagePreviewContainer.appendChild(img);
                    };
                    reader.readAsDataURL(file);
                }
                
                updateStatus(`Loaded ${selectedImages.length} image(s)`, 'success');
            }
            
            // Create PDF from images
            createPdfBtn.addEventListener('click', async function() {
                if (selectedImages.length === 0) {
                    updateStatus('Please select at least one image', 'error');
                    return;
                }
                
                try {
                    updateStatus('Creating PDF from images...', 'info');
                    updateProgress(10, 'Initializing PDF...');
                    
                    // Check if jsPDF is available
                    if (typeof window.jspdf === 'undefined') {
                        throw new Error('jsPDF library not loaded. Please refresh the page.');
                    }
                    
                    const { jsPDF } = window.jspdf;
                    
                    // Get user preferences
                    const pageSize = document.getElementById('pageSize').value;
                    const orientation = document.getElementById('pageOrientation').value;
                    
                    // Create PDF document
                    const pdf = new jsPDF({
                        orientation: orientation,
                        unit: 'mm',
                        format: pageSize === 'fit' ? [100, 100] : pageSize // Will adjust later for fit
                    });
                    
                    let progressIncrement = 80 / selectedImages.length;
                    let currentProgress = 10;
                    
                    // Add each image to the PDF
                    for (let i = 0; i < selectedImages.length; i++) {
                        const imageFile = selectedImages[i];
                        
                        try {
                            const imgData = await fileToDataURL(imageFile);
                            currentProgress += progressIncrement;
                            updateProgress(currentProgress, `Adding image ${i+1}/${selectedImages.length}...`);
                            
                            if (i > 0) {
                                pdf.addPage();
                            }
                            
                            // Get image dimensions
                            const img = await loadImage(imgData);
                            const imgWidth = img.width;
                            const imgHeight = img.height;
                            
                            // Calculate dimensions to fit page
                            const pageWidth = pdf.internal.pageSize.getWidth();
                            const pageHeight = pdf.internal.pageSize.getHeight();
                            
                            let width = pageWidth - 20; // 10mm margin on each side
                            let height = (imgHeight * width) / imgWidth;
                            
                            // If height is too large, adjust
                            if (height > pageHeight - 20) {
                                height = pageHeight - 20;
                                width = (imgWidth * height) / imgHeight;
                            }
                            
                            // Center the image
                            const x = (pageWidth - width) / 2;
                            const y = (pageHeight - height) / 2;
                            
                            // Add image to PDF
                            pdf.addImage(imgData, 'JPEG', x, y, width, height);
                            
                        } catch (error) {
                            console.error(`Error processing image ${i+1}:`, error);
                            updateStatus(`Error processing image ${i+1}. Skipping...`, 'warning');
                        }
                    }
                    
                    updateProgress(95, 'Finalizing PDF...');
                    
                    // Save the PDF
                    const pdfName = `SwiftPDF_Images_${new Date().toISOString().slice(0, 10)}.pdf`;
                    pdf.save(pdfName);
                    
                    updateProgress(100, 'PDF created successfully!');
                    updateStatus(`PDF created with ${selectedImages.length} image(s)`, 'success');
                    
                    // Reset progress after 3 seconds
                    setTimeout(() => {
                        updateProgress(0, '');
                    }, 3000);
                    
                } catch (error) {
                    console.error('Error creating PDF:', error);
                    updateStatus(`Error creating PDF: ${error.message}`, 'error');
                    updateProgress(0, '');
                }
            });
            
            // PDF Compressor functionality
            const compressDropArea = document.getElementById('compressDropArea');
            const compressInput = document.getElementById('compressInput');
            const browseCompressBtn = document.getElementById('browseCompressBtn');
            const compressPdfBtn = document.getElementById('compressPdfBtn');
            const compressFileInfo = document.getElementById('compressFileInfo');
            
            let selectedCompressFile = null;
            
            // Setup drag and drop for PDF compression
            setupFileDrop(compressDropArea, compressInput, handleCompressFileSelected);
            
            browseCompressBtn.addEventListener('click', () => compressInput.click());
            
            compressInput.addEventListener('change', function(e) {
                handleCompressFileSelected(e.target.files);
            });
            
            // Handle PDF file selection for compression
            function handleCompressFileSelected(files) {
                if (files.length === 0) return;
                
                const file = files[0];
                if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
                    updateStatus('Please select a PDF file', 'error');
                    return;
                }
                
                selectedCompressFile = file;
                
                // Display file info
                compressFileInfo.innerHTML = `
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-file-pdf text-red-500 mr-3 text-xl"></i>
                            <div>
                                <p class="font-medium truncate">${file.name}</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${formatFileSize(file.size)}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                updateStatus('PDF file loaded. Ready to compress.', 'success');
            }
            
            // Compress PDF
            compressPdfBtn.addEventListener('click', async function() {
                if (!selectedCompressFile) {
                    updateStatus('Please select a PDF file first', 'error');
                    return;
                }
                
                try {
                    updateStatus('Compressing PDF...', 'info');
                    updateProgress(20, 'Loading PDF...');
                    
                    // Check if PDF-Lib is available
                    if (typeof window.PDFLib === 'undefined') {
                        throw new Error('PDF-Lib library not loaded. Please refresh the page.');
                    }
                    
                    const pdfBytes = await selectedCompressFile.arrayBuffer();
                    
                    updateProgress(40, 'Processing PDF...');
                    
                    // Load PDF with PDF-Lib
                    const pdfDoc = await window.PDFLib.PDFDocument.load(pdfBytes);
                    
                    updateProgress(70, 'Compressing...');
                    
                    // Get compression level
                    const compressionLevel = document.getElementById('compressionLevel').value;
                    
                    // Set compression options based on level
                    let options = {
                        useObjectStreams: true,
                        compress: true
                    };
                    
                    // Adjust quality based on compression level
                    if (compressionLevel === 'high') {
                        options.quality = 0.5;
                    } else if (compressionLevel === 'low') {
                        options.quality = 0.9;
                    } else {
                        options.quality = 0.7; // medium
                    }
                    
                    // Save with compression - using the stable method
                    const compressedPdfBytes = await pdfDoc.save(options);
                    
                    updateProgress(90, 'Creating download...');
                    
                    // Create download link
                    const blob = new Blob([compressedPdfBytes], { type: 'application/pdf' });
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `compressed_${selectedCompressFile.name.replace('.pdf', '')}.pdf`;
                    document.body.appendChild(a);
                    a.click();
                    document.body.removeChild(a);
                    URL.revokeObjectURL(url);
                    
                    const originalSize = selectedCompressFile.size;
                    const compressedSize = compressedPdfBytes.byteLength;
                    const reduction = ((originalSize - compressedSize) / originalSize * 100).toFixed(1);
                    
                    updateProgress(100, 'Compression complete!');
                    updateStatus(`PDF compressed! Size reduced by ${reduction}%`, 'success');
                    
                    // Reset progress after 3 seconds
                    setTimeout(() => {
                        updateProgress(0, '');
                    }, 3000);
                    
                } catch (error) {
                    console.error('Error compressing PDF:', error);
                    updateStatus(`Error compressing PDF: ${error.message}`, 'error');
                    updateProgress(0, '');
                }
            });
            
            // PDF to Image functionality
            const pdfToImgDropArea = document.getElementById('pdfToImgDropArea');
            const pdfToImgInput = document.getElementById('pdfToImgInput');
            const browsePdfToImgBtn = document.getElementById('browsePdfToImgBtn');
            const convertToImagesBtn = document.getElementById('convertToImagesBtn');
            const pdfToImgFileInfo = document.getElementById('pdfToImgFileInfo');
            const imageQuality = document.getElementById('imageQuality');
            const qualityValue = document.getElementById('qualityValue');
            const pdfCanvas = document.getElementById('pdfCanvas');
            
            let selectedPdfToImgFile = null;
            
            // Setup drag and drop for PDF to image
            setupFileDrop(pdfToImgDropArea, pdfToImgInput, handlePdfToImgFileSelected);
            
            browsePdfToImgBtn.addEventListener('click', () => pdfToImgInput.click());
            
            pdfToImgInput.addEventListener('change', function(e) {
                handlePdfToImgFileSelected(e.target.files);
            });
            
            // Update quality display
            imageQuality.addEventListener('input', function() {
                const value = this.value;
                qualityValue.textContent = value >= 8 ? `High (${value}/10)` : 
                                          value >= 5 ? `Medium (${value}/10)` : 
                                          `Low (${value}/10)`;
            });
            
            // Handle PDF file selection for conversion to images
            function handlePdfToImgFileSelected(files) {
                if (files.length === 0) return;
                
                const file = files[0];
                if (file.type !== 'application/pdf' && !file.name.toLowerCase().endsWith('.pdf')) {
                    updateStatus('Please select a PDF file', 'error');
                    return;
                }
                
                selectedPdfToImgFile = file;
                
                // Display file info
                pdfToImgFileInfo.innerHTML = `
                    <div class="bg-gray-50 dark:bg-gray-700 p-4 rounded-lg">
                        <div class="flex items-center">
                            <i class="fas fa-file-pdf text-red-500 mr-3 text-xl"></i>
                            <div>
                                <p class="font-medium truncate">${file.name}</p>
                                <p class="text-sm text-gray-500 dark:text-gray-400">${formatFileSize(file.size)}</p>
                            </div>
                        </div>
                    </div>
                `;
                
                updateStatus('PDF file loaded. Ready to convert.', 'success');
            }
            
            // Convert PDF to images
            convertToImagesBtn.addEventListener('click', async function() {
                if (!selectedPdfToImgFile) {
                    updateStatus('Please select a PDF file first', 'error');
                    return;
                }
                
                try {
                    updateStatus('Converting PDF to images...', 'info');
                    updateProgress(10, 'Loading PDF...');
                    
                    // Check if PDF.js is available
                    if (typeof window.pdfjsLib === 'undefined') {
                        throw new Error('PDF.js library not loaded. Please refresh the page.');
                    }
                    
                    // Set worker source for PDF.js
                    window.pdfjsLib.GlobalWorkerOptions.workerSrc = 'https://cdnjs.cloudflare.com/ajax/libs/pdf.js/3.4.120/pdf.worker.min.js';
                    
                    const pdfBytes = await selectedPdfToImgFile.arrayBuffer();
                    
                    updateProgress(30, 'Parsing PDF document...');
                    
                    // Load the PDF
                    const pdf = await window.pdfjsLib.getDocument({ data: pdfBytes }).promise;
                    const numPages = pdf.numPages;
                    
                    updateStatus(`Converting ${numPages} page(s) to images...`, 'info');
                    
                    // Get user preferences
                    const imageFormat = document.getElementById('imageFormat').value;
                    const quality = parseInt(document.getElementById('imageQuality').value) / 10;
                    
                    let progressIncrement = 60 / numPages;
                    let currentProgress = 30;
                    
                    // Process each page
                    for (let pageNum = 1; pageNum <= numPages; pageNum++) {
                        updateProgress(currentProgress, `Converting page ${pageNum}/${numPages}...`);
                        
                        const page = await pdf.getPage(pageNum);
                        const viewport = page.getViewport({ scale: 2.0 }); // Scale for better quality
                        
                        // Set canvas dimensions
                        pdfCanvas.width = viewport.width;
                        pdfCanvas.height = viewport.height;
                        
                        const ctx = pdfCanvas.getContext('2d');
                        
                        // Render PDF page to canvas
                        await page.render({
                            canvasContext: ctx,
                            viewport: viewport
                        }).promise;
                        
                        currentProgress += progressIncrement;
                        
                        // Convert canvas to image
                        let imageData;
                        let fileExtension;
                        
                        if (imageFormat === 'png') {
                            imageData = pdfCanvas.toDataURL('image/png');
                            fileExtension = 'png';
                        } else {
                            imageData = pdfCanvas.toDataURL('image/jpeg', quality);
                            fileExtension = 'jpg';
                        }
                        
                        // Create download link for this page
                        const a = document.createElement('a');
                        a.href = imageData;
                        a.download = `page_${pageNum}_${selectedPdfToImgFile.name.replace('.pdf', '')}.${fileExtension}`;
                        document.body.appendChild(a);
                        a.click();
                        document.body.removeChild(a);
                    }
                    
                    updateProgress(100, 'Conversion complete!');
                    updateStatus(`Successfully converted ${numPages} page(s) to images`, 'success');
                    
                    // Reset progress after 3 seconds
                    setTimeout(() => {
                        updateProgress(0, '');
                    }, 3000);
                    
                } catch (error) {
                    console.error('Error converting PDF to images:', error);
                    updateStatus(`Error converting PDF: ${error.message}`, 'error');
                    updateProgress(0, '');
                }
            });
        }
        
        // Helper function to set up drag and drop
        function setupFileDrop(dropArea, fileInput, callback) {
            dropArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                dropArea.classList.add('dragover');
            });
            
            dropArea.addEventListener('dragleave', function() {
                dropArea.classList.remove('dragover');
            });
            
            dropArea.addEventListener('drop', function(e) {
                e.preventDefault();
                dropArea.classList.remove('dragover');
                
                if (e.dataTransfer.files.length) {
                    fileInput.files = e.dataTransfer.files;
                    callback(e.dataTransfer.files);
                }
            });
            
            dropArea.addEventListener('click', function() {
                fileInput.click();
            });
        }
        
        // Helper function to convert file to data URL
        function fileToDataURL(file) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = () => resolve(reader.result);
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }
        
        // Helper function to load image from data URL
        function loadImage(src) {
            return new Promise((resolve, reject) => {
                const img = new Image();
                img.onload = () => resolve(img);
                img.onerror = reject;
                img.src = src;
            });
        }
        
        // Helper function to format file size
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
    </script>
</body>
</html>
